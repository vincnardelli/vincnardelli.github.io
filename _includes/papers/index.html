<!-- Remote Projects JS -->
<script src="{{ '/assets/js/remote-projects.js' | relative_url }}"></script>

<div class="m-3 mt-5">
  <h2>Papers</h2>  

  <!-- Filters -->
  <div class="row mb-4">
    <div class="col-md-6 mb-3 mb-md-0">
      <label for="category-filter" class="form-label"><strong>Filter by type:</strong></label>
      <select id="category-filter" class="form-control">
        <option value="">All types</option>
      </select>
    </div>
    <div class="col-md-6">
      <label for="year-filter" class="form-label"><strong>Filter by year:</strong></label>
      <select id="year-filter" class="form-control">
        <option value="">All years</option>
      </select>
    </div>
  </div>

  <!-- Results count -->
  <div id="results-count" class="mb-3 text-muted">
    <span id="count-number">-</span> publications found
  </div>

  <!-- Papers Container -->
  <div id="papers-container">
    <!-- Papers will be loaded here -->
  </div>

  <!-- No results message -->
  <div id="no-results" class="alert alert-info" style="display: none;">
    No publications found with the selected filters.
  </div>
</div>

<script>
(function() {
  const primaryColor = '#80bdff';
  let allPapers = [];
  
  // Fetch papers data
  fetch('{{ "/assets/papers.json" | relative_url }}')
    .then(response => response.json())
    .then(papers => {
      allPapers = papers;
      
      // Populate filter dropdowns
      const categories = [...new Set(papers.map(p => p.category).filter(c => c))].sort();
      const years = [...new Set(papers.map(p => p.year).filter(y => y))].sort((a, b) => b - a);
      
      const categoryFilter = document.getElementById('category-filter');
      const yearFilter = document.getElementById('year-filter');
      
      categories.forEach(cat => {
        const option = document.createElement('option');
        option.value = cat;
        option.textContent = cat;
        categoryFilter.appendChild(option);
      });
      
      years.forEach(year => {
        const option = document.createElement('option');
        option.value = year;
        option.textContent = year;
        yearFilter.appendChild(option);
      });
      
      // Initial render
      renderPapers(papers);
      
      // Add filter event listeners
      categoryFilter.addEventListener('change', filterPapers);
      yearFilter.addEventListener('change', filterPapers);
    })
    .catch(error => {
      console.error('Error loading papers:', error);
      document.getElementById('papers-container').innerHTML = 
        '<p class="text-danger">Error loading papers. Please try again later.</p>';
    });
  
  function renderPapers(papers) {
    const container = document.getElementById('papers-container');
    container.innerHTML = '';
    
    // Sort by date (newest first)
    papers.sort((a, b) => {
      const dateA = a.date ? new Date(a.date) : new Date(a.year || 0, 0, 1);
      const dateB = b.date ? new Date(b.date) : new Date(b.year || 0, 0, 1);
      return dateB - dateA;
    });
    
    let itemCount = 0;
    
    papers.forEach(paper => {
      // Start of row for every three items
      if (itemCount % 3 === 0) {
        const row = document.createElement('div');
        row.className = 'row paper-row';
        row.id = `paper-row-${Math.floor(itemCount / 3)}`;
        container.appendChild(row);
      }
      
      // Get current row
      const currentRow = document.getElementById(`paper-row-${Math.floor(itemCount / 3)}`);
      
      // Create paper card column
      const col = document.createElement('div');
      col.className = 'col-md-4 wow animated fadeIn paper-item mb-4';
      col.setAttribute('data-wow-delay', '.15s');
      col.setAttribute('data-category', paper.category || '');
      col.setAttribute('data-year', paper.year || '');
      
      // Determine URL (use link if available, otherwise generate from slug)
      const paperUrl = paper.link || `/papers/${paper.slug || paper.filename || ''}`;
      
      // Create card with colored styling (similar to conferences)
      col.innerHTML = `
        <div class="wow animated fadeIn" data-wow-delay=".15s">
          <a href="${paperUrl}" class="paper-card project card text-dark" target="${paper.link ? '_blank' : '_self'}">
            <div class="paper-card-header" style="background: linear-gradient(120deg, ${primaryColor}, 70%, ${primaryColor} 100%);">
              <span class="paper-category-badge">${paper.category || 'Publication'}</span>
            </div>
            <div class="card-body">
              <p class="paper-meta">
                ${paper.journal ? `<i class="fas fa-book" style="color: ${primaryColor};"></i> ${paper.journal}` : ''} 
                ${paper.year ? ` <i class="fas fa-calendar-alt" style="color: ${primaryColor};"></i> ${paper.year}` : ''}
              </p>
              <h5 class="card-title paper-title">
                ${paper.name || paper.title}
              </h5>
              ${paper.abstract ? `<p class="card-text paper-abstract">${paper.abstract.substring(0, 150)}${paper.abstract.length > 150 ? '...' : ''}</p>` : ''}
            </div>
          </a>
        </div>
      `;
      
      currentRow.appendChild(col);
      itemCount++;
    });
    
    // Update count
    document.getElementById('count-number').textContent = papers.length;
  }
  
  function filterPapers() {
    const categoryFilter = document.getElementById('category-filter');
    const yearFilter = document.getElementById('year-filter');
    const papersContainer = document.getElementById('papers-container');
    const noResults = document.getElementById('no-results');
    const countNumber = document.getElementById('count-number');
    
    const selectedCategory = categoryFilter.value;
    const selectedYear = yearFilter.value;
    const paperItems = papersContainer.querySelectorAll('.paper-item');
    let visibleCount = 0;
    
    paperItems.forEach(function(item) {
      const category = item.getAttribute('data-category') || '';
      const year = item.getAttribute('data-year') || '';
      
      const categoryMatch = !selectedCategory || category === selectedCategory;
      const yearMatch = !selectedYear || year === selectedYear;
      
      if (categoryMatch && yearMatch) {
        item.style.display = '';
        visibleCount++;
      } else {
        item.style.display = 'none';
      }
    });
    
    // Hide empty rows
    const rows = papersContainer.querySelectorAll('.paper-row');
    rows.forEach(function(row) {
      const visibleItems = row.querySelectorAll('.paper-item[style=""], .paper-item:not([style*="display: none"])');
      if (visibleItems.length === 0) {
        row.style.display = 'none';
      } else {
        row.style.display = '';
      }
    });
    
    // Update count and show/hide no results message
    countNumber.textContent = visibleCount;
    if (visibleCount === 0) {
      noResults.style.display = 'block';
      papersContainer.style.display = 'none';
    } else {
      noResults.style.display = 'none';
      papersContainer.style.display = 'block';
    }
  }
})();
</script>

<style>
.paper-card {
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  height: 100%;
  border: none;
  border-radius: 28px;
  overflow: hidden;
  box-shadow: 0 8px 32px rgba(0,0,0,0.1);
  text-decoration: none;
  color: inherit;
  display: flex;
  flex-direction: column;
  background: rgba(255, 255, 255, 0.7);
  backdrop-filter: blur(20px) saturate(180%);
  -webkit-backdrop-filter: blur(20px) saturate(180%);
  border: 1px solid rgba(255, 255, 255, 0.18);
}

.paper-card:hover {
  transform: translateY(-8px) scale(1.02);
  box-shadow: 0 12px 48px rgba(128, 189, 255, 0.3);
  text-decoration: none;
  color: inherit;
  border-color: rgba(128, 189, 255, 0.4);
}

.paper-card-header {
  padding: 16px 24px;
  color: white;
  background: linear-gradient(135deg, #80bdff 0%, #5a9fd4 100%);
  position: relative;
  overflow: hidden;
}

.paper-card-header::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: left 0.5s;
}

.paper-card:hover .paper-card-header::before {
  left: 100%;
}

.paper-category-badge {
  display: inline-block;
  background: rgba(255, 255, 255, 0.3);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  padding: 6px 16px;
  border-radius: 20px;
  font-size: 0.85em;
  font-weight: 600;
  color: white;
  border: 1px solid rgba(255, 255, 255, 0.3);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.paper-card:hover .paper-category-badge {
  background: rgba(255, 255, 255, 0.4);
  transform: scale(1.05);
}

.paper-meta {
  color: #6c757d;
  font-size: 0.9em;
  margin-bottom: 0.75rem;
  display: flex;
  align-items: center;
  gap: 12px;
  flex-wrap: wrap;
}

.paper-meta i {
  width: 16px;
  text-align: center;
  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.paper-card:hover .paper-meta i {
  transform: scale(1.2);
}

.paper-title {
  color: #343a40;
  font-weight: 600;
  margin-bottom: 1rem;
  line-height: 1.4;
  font-size: 1.1em;
  transition: color 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.paper-card:hover .paper-title {
  color: #80bdff;
}

.paper-abstract {
  color: #6c757d;
  font-size: 0.95em;
  line-height: 1.5;
  margin-bottom: 0;
}

.paper-item {
  animation-fill-mode: both;
}

/* Ensure rows are properly displayed */
.paper-row {
  margin-bottom: 0;
}

/* Filter styling with liquid design */
.form-control {
  background: rgba(255, 255, 255, 0.7);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.18);
  border-radius: 16px;
  padding: 12px 16px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
}

.form-control:focus {
  background: rgba(255, 255, 255, 0.9);
  border-color: rgba(128, 189, 255, 0.5);
  box-shadow: 0 8px 24px rgba(128, 189, 255, 0.2);
  outline: none;
}

.alert-info {
  background: rgba(128, 189, 255, 0.2);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  border: 1px solid rgba(128, 189, 255, 0.3);
  border-radius: 20px;
  color: #0056b3;
}
</style>
